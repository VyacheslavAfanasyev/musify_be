# –ß—Ç–æ –µ—â–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –∏–∑ ARCHITECTURE_ANALYSIS.md

## ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (–≠—Ç–∞–ø 1) ‚úÖ
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–µ MongoDB –∏–Ω—Å—Ç–∞–Ω—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
  - `mongodb_user` ‚Üí user_db
  - `mongodb_media` ‚Üí media_db
  - `mongodb_social` ‚Üí social_db
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–π PostgreSQL –¥–ª—è auth: `postgres_auth` ‚Üí auth_db
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ docker-compose.yml –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Redis (–≠—Ç–∞–ø 1) ‚úÖ
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–µ Redis –∏–Ω—Å—Ç–∞–Ω—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
  - `redis_auth` (–ø–æ—Ä—Ç 6379)
  - `redis_user` (–ø–æ—Ä—Ç 6380)
  - `redis_media` (–ø–æ—Ä—Ç 6381)
  - `redis_social` (–ø–æ—Ä—Ç 6382)
- ‚úÖ –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–≤–æ–µ–º—É Redis –∏–Ω—Å—Ç–∞–Ω—Å—É

### 3. –ß–∞—Å—Ç–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Event-Driven (–≠—Ç–∞–ø 2) ‚úÖ
- ‚úÖ –ï—Å—Ç—å EventPattern –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ user.controller.ts:
  - `user.created`
  - `user.updated`
  - `user.deleted`
  - `follow.created`
  - `follow.deleted`
  - `media.track.uploaded`
  - `media.track.deleted`
  - `media.avatar.uploaded`
  - `media.avatar.deleted`
- ‚úÖ Social service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è `follow.created` (emit)

---

## ‚ùå –ß—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –≠—Ç–∞–ø 2: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä—è–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ö—Ä–∏—Ç–∏—á–Ω–æ)

#### 2.1. –ó–∞–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ —Å–æ–±—ã—Ç–∏—è ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** Media –∏ Social —Å–µ—Ä–≤–∏—Å—ã –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `MessagePattern` –∫ User Service.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ `media.service.ts` - —É–±—Ä–∞–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `updateProfile` –∏ `getProfileByUserId`
- ‚úÖ `media.controller.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π `user.created`, `user.updated`, `user.deleted` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫—ç—à–∞
- ‚úÖ `social.service.ts` - –∑–∞–º–µ–Ω–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏
- ‚úÖ `social.controller.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ö–µ–º–∞ `UserProfileReplica` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ Social Service

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **Media Service:**
   - ‚úÖ –£–±—Ä–∞–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `updateProfile` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–µ `media.avatar.uploaded`)
   - ‚úÖ –£–±—Ä–∞–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `getProfileByUserId` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π `user.created`, `user.updated`, `user.deleted` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫—ç—à–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Redis

2. **Social Service:**
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ö–µ–º–∞ `UserProfileReplica` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π: `user.created`, `user.updated`, `user.deleted`, `media.avatar.uploaded`, `media.avatar.deleted`, `follow.created`, `follow.deleted`
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω CQRS –ø–∞—Ç—Ç–µ—Ä–Ω: —á—Ç–µ–Ω–∏–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (UserProfileReplica), —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
   - ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `getProfileByUsername` –∏ `getProfileByUserId` –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
     - `getPublicProfile()`
     - `getUserFeed()`
     - `handleTrackPublished()`

3. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Saga Pattern):** ‚úÖ

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–°–æ–∑–¥–∞–Ω Saga Service (`saga.service.ts`):**
   - ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–∞–≥ (—Å–æ–∑–¥–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è)
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Choreography Pattern –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–æ—Ç–∫–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–≥–∏
   - ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–∞–≥

2. **–°–æ–∑–¥–∞–Ω—ã —Ç–∏–ø—ã –¥–ª—è Saga Pattern (`shared/types/saga.ts`):**
   - ‚úÖ `ISaga`, `ISagaStep`, `ISagaContext` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∞–≥–∞–º–∏
   - ‚úÖ `SagaType`, `SagaStatus`, `SagaStepStatus` - –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–∞–≥: USER_CREATION, USER_DELETION, MEDIA_UPLOAD, MEDIA_DELETION, FOLLOW_CREATION, FOLLOW_DELETION

3. **–£–ª—É—á—à–µ–Ω–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –≤ user_db –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ auth_db
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Saga Service –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞–º–∏:**
   - ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ `compensateDeleteFile` –≤ Media Controller
   - ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `uploadFile` –º–µ—Ç–æ–¥–µ

5. **–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:**
   - ‚úÖ `deleteProfile` –≤ User Controller (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è)
   - ‚úÖ `compensateDeleteFile` –≤ Media Controller (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞)
   - ‚úÖ `compensateUnfollow` –≤ Social Controller (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏)
   - ‚úÖ `compensateDeleteProfileReplica` –≤ Social Controller (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Ä–µ–ø–ª–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è)

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Saga Service –≤ Auth Module:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è MEDIA_SERVICE –∏ SOCIAL_SERVICE
   - ‚úÖ Saga Service –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Saga Service –≤ `register` –º–µ—Ç–æ–¥–µ Auth Service

**–ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
// –°–æ–±—ã—Ç–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
'user.validated' - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä–µ–Ω
'user.not.found' - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

// –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
'user.profile.synced' - –∫–æ–≥–¥–∞ –ø—Ä–æ—Ñ–∏–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω
'user.stats.updated' - –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

---

### –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ API Gateway (–ö—Ä–∏—Ç–∏—á–Ω–æ)

#### 3.1. –£–±—Ä–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ Gateway ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** API Gateway –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ `getUserProfile()` –≤ `app.service.ts` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ User Service
- ‚úÖ `getUserProfileByUsername()` —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ User Service
- ‚úÖ `getPublicProfile()` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Social Service (—É–∂–µ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ User Service:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω AUTH_SERVICE ClientProxy –≤ User Service –º–æ–¥—É–ª—å
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ email –≤ User Service –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è `user.created`
   - ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–µ—Ç–æ–¥—ã `getUserProfile()` –∏ `getUserProfileByUsername()` –≤ User Service –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ User Service —Å–∞–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç email –∏–∑ Auth Service (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
   - ‚úÖ User Service –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å email
   - ‚úÖ Gateway —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (—É–±—Ä–∞–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è)

2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: GraphQL Gateway**
   - ‚ùå –í–Ω–µ–¥—Ä–∏—Ç—å Apollo Federation –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - ‚ùå –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–π GraphQL schema
   - ‚ùå Gateway –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å—Ö–µ–º—ã

**–ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```typescript
// ‚ùå –¢–µ–∫—É—â–∏–π –∫–æ–¥ –≤ Gateway
async getUserProfile(userId: string) {
  const authResult = await this.sendToAuthService(...);
  const profileResult = await this.sendToUserService(...);
  return { ...authResult, ...profileResult }; // –ê–≥—Ä–µ–≥–∞—Ü–∏—è
}

// ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å
async getUserProfile(userId: string) {
  return this.sendToUserService('getUserProfile', { userId });
  // User Service —Å–∞–º –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
}
```

---

### –≠—Ç–∞–ø 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—â–∏–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

#### 4.1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** Shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –±–µ–∑ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ `shared/package.json` –∏–º–µ–µ—Ç `"private": true` –∏ –≤–µ—Ä—Å–∏—é `1.0.0` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π metadata
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `"@app/shared": "file:../../shared"` (—á–µ—Ä–µ–∑ npm workspaces)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ Semantic Versioning (SemVer)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω CHANGELOG.md –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é (VERSIONING.md)

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ Semantic Versioning:**
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `shared/package.json` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π metadata (author, license, keywords, repository)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏: `version:patch`, `version:minor`, `version:major`, `version:show`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π `package.json`: `shared:version`, `shared:version:patch`, `shared:version:minor`, `shared:version:major`

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - ‚úÖ –°–æ–∑–¥–∞–Ω `shared/CHANGELOG.md` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–µ—Ä—Å–∏–π
   - ‚úÖ –°–æ–∑–¥–∞–Ω `shared/VERSIONING.md` —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ø–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
   - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

3. **–ü—Ä–æ—Ü–µ—Å—Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - ‚úÖ PATCH –≤–µ—Ä—Å–∏—è (1.0.0 ‚Üí 1.0.1) - –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—à–∏–±–æ–∫
   - ‚úÖ MINOR –≤–µ—Ä—Å–∏—è (1.0.0 ‚Üí 1.1.0) - –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö)
   - ‚úÖ MAJOR –≤–µ—Ä—Å–∏—è (1.0.0 ‚Üí 2.0.0) - –¥–ª—è breaking changes

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
npm run shared:version

# –û–±–Ω–æ–≤–∏—Ç—å PATCH –≤–µ—Ä—Å–∏—é
npm run shared:version:patch

# –û–±–Ω–æ–≤–∏—Ç—å MINOR –≤–µ—Ä—Å–∏—é
npm run shared:version:minor

# –û–±–Ω–æ–≤–∏—Ç—å MAJOR –≤–µ—Ä—Å–∏—é
npm run shared:version:major
```

**–ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

1. **–í–∞—Ä–∏–∞–Ω—Ç 1: NPM –ø–∞–∫–µ—Ç (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)**
   - ‚ùå –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å shared –∫–∞–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π NPM –ø–∞–∫–µ—Ç `@pet/shared-types`
   - ‚ùå –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è NPM –ø–∞–∫–µ—Ç–∞
   - ‚ùå –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

2. **–í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π NPM registry (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)**
   - ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Verdaccio –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
   - ‚ùå –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

3. **–í–∞—Ä–∏–∞–Ω—Ç 3: API Contracts (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**
   - ‚ùå –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —á–µ—Ä–µ–∑ OpenAPI/Swagger
   - ‚ùå –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
   - ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Schema Registry –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å, –Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è) ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

---

### –≠—Ç–∞–ø 5: –£–ª—É—á—à–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### 5.1. Service Discovery ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ URL —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ùå –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `process.env.RABBITMQ_URL`
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–í–∞—Ä–∏–∞–Ω—Ç 1: Consul (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
   - ‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Consul –≤ docker-compose.yml
   - ‚ùå –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Consul –≤ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å
   - ‚ùå –ó–∞–º–µ–Ω–∏—Ç—å –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ URL –Ω–∞ Service Discovery

2. **–í–∞—Ä–∏–∞–Ω—Ç 2: Kubernetes Service Discovery**
   - ‚ùå –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ K8s
   - ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Service Discovery K8s

3. **–í–∞—Ä–∏–∞–Ω—Ç 3: Eureka (–¥–ª—è Java —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã, –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)**

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

---

#### 5.2. Circuit Breaker ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `opossum`
- ‚úÖ –°–æ–∑–¥–∞–Ω `CircuitBreakerService` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Circuit Breakers
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã –∫ —Å–µ—Ä–≤–∏—Å–∞–º –æ–±–µ—Ä–Ω—É—Ç—ã –≤ Circuit Breaker
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ—Ä–æ–≥–∏ –æ—à–∏–±–æ–∫ (50% –æ—à–∏–±–æ–∫, 30 —Å–µ–∫—É–Ω–¥ –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è Circuit Breaker
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint `/health/circuit-breakers` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:**
   ```bash
   npm install opossum
   ```

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Circuit Breaker –≤ API Gateway:**
   - ‚úÖ –°–æ–∑–¥–∞–Ω `CircuitBreakerService` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Circuit Breakers
   - ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã `sendTo*Service` –∏—Å–ø–æ–ª—å–∑—É—é—Ç Circuit Breaker
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ—Ä–æ–≥–∏ –æ—à–∏–±–æ–∫: 50% –æ—à–∏–±–æ–∫, —Ç–∞–π–º–∞—É—Ç 10-30 —Å–µ–∫—É–Ω–¥, resetTimeout 30 —Å–µ–∫—É–Ω–¥
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã fallback –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤:
     - `getUserProfile()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
     - `getUserProfileByUsername()` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
     - `login()` –∏ `register()` - fallback –¥–ª—è Auth Service
     - `getPublicProfile()` –∏ `getUserFeed()` - fallback –¥–ª—è Social Service
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π: open, halfOpen, close, failure
   - ‚úÖ Endpoint `/health/circuit-breakers` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

3. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
   - `CircuitBreakerService` —É–ø—Ä–∞–≤–ª—è–µ—Ç Circuit Breakers –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
   - –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç —Å–≤–æ–π Circuit Breaker —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏) ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

#### 5.3. Distributed Tracing ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OpenTelemetry SDK –∏ auto-instrumentations
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω Jaeger –≤ docker-compose.yml
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Ç—Ä–µ–π—Å–∏–Ω–≥ –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ trace ID —á–µ—Ä–µ–∑ HTTP –∏ RabbitMQ
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–µ–π—Å—ã –≤ Jaeger

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OpenTelemetry:**
   - ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã: `@opentelemetry/sdk-node`, `@opentelemetry/auto-instrumentations-node`, `@opentelemetry/resources`, `@opentelemetry/semantic-conventions`, `@opentelemetry/exporter-jaeger`, `@opentelemetry/sdk-trace-base`
   - ‚úÖ –ü–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (api-gateway, auth, user, media, social)
   - ‚úÖ –ü–∞–∫–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ shared –±–∏–±–ª–∏–æ—Ç–µ–∫—É

2. **–ù–∞—Å—Ç—Ä–æ–µ–Ω Jaeger:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω Jaeger –≤ docker-compose.yml (–ø–æ—Ä—Ç—ã: 16686 - UI, 14268 - collector, 6831/6832 - agent)
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω health check –¥–ª—è Jaeger
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –æ–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OpenTelemetry –≤ `shared/libs/tracing.ts`

3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Ç—Ä–µ–π—Å–∏–Ω–≥ –≤ —Å–µ—Ä–≤–∏—Å—ã:**
   - ‚úÖ API Gateway: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ main.ts
   - ‚úÖ Auth Service: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ main.ts
   - ‚úÖ User Service: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ main.ts
   - ‚úÖ Media Service: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ main.ts
   - ‚úÖ Social Service: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ main.ts
   - ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—É–Ω–∫—Ü–∏—é `initializeTracing()` –∏–∑ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (SIGTERM) –¥–ª—è graceful shutdown —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ trace ID:**
   - ‚úÖ OpenTelemetry auto-instrumentations –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç trace context —á–µ—Ä–µ–∑ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
   - ‚úÖ OpenTelemetry auto-instrumentations –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç trace context —á–µ—Ä–µ–∑ RabbitMQ (—á–µ—Ä–µ–∑ amqplib)
   - ‚úÖ Trace ID –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Jaeger: `docker-compose up jaeger`
2. –û—Ç–∫—Ä—ã—Ç—å Jaeger UI: http://localhost:16686
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API Gateway
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–µ–π—Å—ã –≤ Jaeger UI

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–≤–∞–∂–Ω–æ –¥–ª—è production, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ) ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

#### 5.4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Loki –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Promtail –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤ –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ Loki
   - ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å trace ID –≤ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ trace ID —á–µ—Ä–µ–∑ OpenTelemetry
   - ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–ú–µ—Ç—Ä–∏–∫–∏:**
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Prometheus –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
   - ‚úÖ –°–æ–∑–¥–∞–Ω PrometheusService –≤ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–µ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
     - HTTP –º–µ—Ç—Ä–∏–∫–∏: `http_request_duration_seconds`, `http_requests_total`, `http_request_errors_total`
     - Circuit Breaker –º–µ—Ç—Ä–∏–∫–∏: `circuit_breaker_state`
     - Saga –º–µ—Ç—Ä–∏–∫–∏: `saga_duration_seconds`, `saga_total`, `saga_errors_total`
     - –ë–∏–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∏: `user_registrations_total`, `user_logins_total`, `file_uploads_total`, `follows_created_total`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint `/metrics` –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω —Å–∫—Ä–∞–ø–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –≤ Prometheus –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - ‚úÖ –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ –≤ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Grafana: Prometheus, Loki, Jaeger
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `SERVICE_NAME` –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ `monitoring/README.md`

3. **Health checks:** ‚úÖ
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @nestjs/terminus –¥–ª—è health checks
   - ‚úÖ Endpoint `/health` –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î, Redis, RabbitMQ
   
   **–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**
   
   1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω @nestjs/terminus –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:**
      - ‚úÖ Auth Service
      - ‚úÖ User Service
      - ‚úÖ Media Service
      - ‚úÖ Social Service
      - ‚úÖ API Gateway
   
   2. **–°–æ–∑–¥–∞–Ω—ã health check –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:**
      - ‚úÖ Auth Service: –ø—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL, Redis, RabbitMQ, –ø–∞–º—è—Ç–∏
      - ‚úÖ User Service: –ø—Ä–æ–≤–µ—Ä–∫–∞ MongoDB, Redis, RabbitMQ, –ø–∞–º—è—Ç–∏
      - ‚úÖ Media Service: –ø—Ä–æ–≤–µ—Ä–∫–∞ MongoDB, Redis, RabbitMQ, –ø–∞–º—è—Ç–∏
      - ‚úÖ Social Service: –ø—Ä–æ–≤–µ—Ä–∫–∞ MongoDB, Redis, RabbitMQ, –ø–∞–º—è—Ç–∏
      - ‚úÖ API Gateway: –ø—Ä–æ–≤–µ—Ä–∫–∞ RabbitMQ, –ø–∞–º—è—Ç–∏
   
   3. **–°–æ–∑–¥–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π RabbitMQ Health Indicator:**
      - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ —á–µ—Ä–µ–∑ amqplib
      - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
   
   4. **–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥–∏–±—Ä–∏–¥–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
      - ‚úÖ –í—Å–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –≥–∏–±—Ä–∏–¥–Ω—ã–µ (HTTP + RabbitMQ)
      - ‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è health checks
      - ‚úÖ RabbitMQ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
   
   5. **Endpoints:**
      - ‚úÖ `GET /health` - –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ
      - ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ë–î, Redis, RabbitMQ, –ø–∞–º—è—Ç—å)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–≤–∞–∂–Ω–æ –¥–ª—è production)

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å):
1. ‚úÖ **–≠—Ç–∞–ø 2.1:** –ó–∞–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ Media –∏ Social —Å–µ—Ä–≤–∏—Å–∞—Ö
2. ‚úÖ **–≠—Ç–∞–ø 3.1:** –£–±—Ä–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ API Gateway
3. ‚úÖ **–≠—Ç–∞–ø 5.2:** –î–æ–±–∞–≤–∏—Ç—å Circuit Breaker

### üü° –í–∞–∂–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤–æ –≤—Ç–æ—Ä—É—é –æ—á–µ—Ä–µ–¥—å):
4. ‚úÖ **–≠—Ç–∞–ø 2.3:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Saga Pattern –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
5. ‚úÖ **–≠—Ç–∞–ø 5.3:** –î–æ–±–∞–≤–∏—Ç—å Distributed Tracing - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
6. ‚úÖ **–≠—Ç–∞–ø 5.4:** Health checks (–±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞) - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):
7. ‚úÖ **–≠—Ç–∞–ø 4.1:** –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
8. **–≠—Ç–∞–ø 5.1:** Service Discovery
9. ‚úÖ **–≠—Ç–∞–ø 5.4:** –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (ELK/Prometheus/Grafana) - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** 11 –∏–∑ 12 –∑–∞–¥–∞—á (92%)
- ‚ùå **–û—Å—Ç–∞–ª–æ—Å—å:** 1 –∑–∞–¥–∞—á–∞ (8%)

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:** 3 –∏–∑ 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (100%) ‚úÖ
**–í–∞–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏:** 3 –∏–∑ 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (100%) ‚úÖ
**–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:** 2 –∏–∑ 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (67%)

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–≠—Ç–∞–ø 2.1** - –∑–∞–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
2. ‚úÖ **–≠—Ç–∞–ø 3.1** - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ API Gateway (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
3. ‚úÖ **–≠—Ç–∞–ø 5.2** - –¥–æ–±–∞–≤–∏—Ç—å Circuit Breaker –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
4. ‚úÖ **–≠—Ç–∞–ø 2.3** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Saga Pattern –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
5. ‚úÖ **–≠—Ç–∞–ø 5.4** - Health checks (–±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞) (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
6. ‚úÖ **–≠—Ç–∞–ø 5.3** - –¥–æ–±–∞–≤–∏—Ç—å Distributed Tracing (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
7. ‚úÖ **–≠—Ç–∞–ø 5.4** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏ (Loki/Prometheus/Grafana) (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
8. ‚úÖ **–≠—Ç–∞–ø 4.1** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
9. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

