# Версионирование Shared Библиотеки

Этот документ описывает процесс версионирования библиотеки `@app/shared` и правила работы с версиями.

## Обзор

Библиотека `@app/shared` использует [Semantic Versioning (SemVer)](https://semver.org/) для управления версиями. Это позволяет отслеживать изменения и обеспечивать совместимость между версиями.

## Текущая версия

Текущая версия библиотеки: **1.0.0**

## Формат версии

Версии следуют формату `MAJOR.MINOR.PATCH`:

- **MAJOR** (X.0.0) - Breaking changes (несовместимые изменения)
- **MINOR** (0.X.0) - Новые функции (обратно совместимые)
- **PATCH** (0.0.X) - Исправления ошибок (обратно совместимые)

## Управление версиями

### Просмотр текущей версии

```bash
# Из корня проекта
npm run shared:version

# Или из директории shared
cd shared
npm run version:show
```

### Обновление версии

#### PATCH версия (1.0.0 → 1.0.1)
Используется для исправлений ошибок и мелких изменений:

```bash
# Из корня проекта
npm run shared:version:patch

# Или из директории shared
cd shared
npm run version:patch
```

**Когда использовать:**
- Исправление багов в существующих функциях
- Исправление опечаток в типах
- Добавление недостающих опциональных полей
- Обновление документации

#### MINOR версия (1.0.0 → 1.1.0)
Используется для новых функций, которые обратно совместимы:

```bash
# Из корня проекта
npm run shared:version:minor

# Или из директории shared
cd shared
npm run version:minor
```

**Когда использовать:**
- Добавление новых типов, интерфейсов, классов
- Добавление новых сущностей или схем
- Добавление новых утилит
- Добавление опциональных полей в существующие интерфейсы
- Расширение функциональности без изменения существующего API

#### MAJOR версия (1.0.0 → 2.0.0)
Используется для breaking changes:

```bash
# Из корня проекта
npm run shared:version:major

# Или из директории shared
cd shared
npm run version:major
```

**Когда использовать:**
- Удаление экспортируемых типов, интерфейсов, классов
- Переименование экспортируемых типов
- Изменение обязательных полей в интерфейсах
- Изменение сигнатур функций
- Изменение структуры данных, которая используется в других сервисах

## Процесс обновления версии

1. **Внесите изменения** в код библиотеки
2. **Обновите CHANGELOG.md** с описанием изменений
3. **Обновите версию** используя соответствующий скрипт:
   ```bash
   npm run shared:version:patch  # или :minor, :major
   ```
4. **Проверьте**, что версия обновилась:
   ```bash
   npm run shared:version
   ```
5. **Обновите зависимости** в сервисах (если необходимо):
   ```bash
   npm install
   ```

## Использование в сервисах

Все микросервисы используют shared библиотеку через npm workspaces:

```json
{
  "dependencies": {
    "@app/shared": "file:../../shared"
  }
}
```

При обновлении версии shared библиотеки, все сервисы автоматически получат новую версию благодаря npm workspaces.

## Примеры изменений

### Пример PATCH версии

**До:**
```typescript
export interface IUserProfile {
  username: string;
  email: string;
}
```

**После:**
```typescript
export interface IUserProfile {
  username: string;
  email: string;
  bio?: string; // Добавлено опциональное поле
}
```

**Версия:** 1.0.0 → 1.0.1

### Пример MINOR версии

**Добавлен новый тип:**
```typescript
export interface IUserSettings {
  theme: 'light' | 'dark';
  notifications: boolean;
}
```

**Версия:** 1.0.0 → 1.1.0

### Пример MAJOR версии

**До:**
```typescript
export interface IUserProfile {
  username: string;
  email: string;
}
```

**После:**
```typescript
export interface IUserProfile {
  userId: string;  // Переименовано из username
  email: string;
}
```

**Версия:** 1.0.0 → 2.0.0

## CHANGELOG.md

Все изменения должны быть задокументированы в `shared/CHANGELOG.md`. Формат:

```markdown
## [1.1.0] - 2024-01-15

### Added
- Новый тип IUserSettings
- Новая утилита formatDate

### Changed
- Обновлен интерфейс IUserProfile (добавлено опциональное поле bio)

### Fixed
- Исправлена опечатка в типе IAuthResponse
```

## Миграция на NPM пакет (будущее)

В будущем библиотека может быть опубликована как приватный NPM пакет. В этом случае:

1. Версионирование останется таким же (SemVer)
2. Сервисы будут использовать версионированные зависимости:
   ```json
   {
     "dependencies": {
       "@app/shared": "^1.1.0"
     }
   }
   ```
3. Можно будет использовать разные версии в разных сервисах при необходимости

## Рекомендации

1. **Всегда обновляйте CHANGELOG.md** при изменении версии
2. **Тестируйте изменения** в сервисах после обновления версии
3. **Используйте PATCH** для мелких изменений
4. **Используйте MINOR** для новых функций
5. **Используйте MAJOR** только при необходимости breaking changes
6. **Коммитьте изменения версии** вместе с кодом

## Полезные команды

```bash
# Показать текущую версию
npm run shared:version

# Обновить PATCH версию
npm run shared:version:patch

# Обновить MINOR версию
npm run shared:version:minor

# Обновить MAJOR версию
npm run shared:version:major

# Установить зависимости после обновления
npm install
```

